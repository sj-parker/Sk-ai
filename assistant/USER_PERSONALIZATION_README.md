# –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø—É—Ç–µ–º –ø–µ—Ä–µ–¥–∞—á–∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ –∏–º–µ–Ω–∏ –∏ –¥–µ–ª–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `memory/manager.py`

–ú–µ—Ç–æ–¥ `get_context_as_system_prompt()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `user_name`:

```python
def get_context_as_system_prompt(self, user_name=None):
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
- –ï—Å–ª–∏ `user_name` –ø–µ—Ä–µ–¥–∞–Ω, –æ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç: `"–¢—ã –°–∫–∞–π, –≤–µ–¥—É—â–∞—è —Å—Ç—Ä–∏–º —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_name}."`
- –ï—Å–ª–∏ `user_name` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç: `"–¢—ã –°–∫–∞–π, –≤–µ–¥—É—â–∞—è —Å—Ç—Ä–∏–º —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏."`

### 2. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `audio_output.py`

–§—É–Ω–∫—Ü–∏—è `chat_stream_ollama()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `user_name`:

```python
async def chat_stream_ollama(role_manager, memory, prompt, model_name="gemma3n:e2b", speak=True, user_name=None):
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö

#### `twitch_youtube_chat.py`
```python
response = await chat_stream_ollama(role_manager, memory, text, speak=True, user_name=user)
```

#### `telegram_bot.py`
```python
user_name = update.effective_user.first_name or update.effective_user.username or user_id
response = await chat_stream_ollama(role_manager, memory, user_input, speak=False, user_name=user_name)
```

#### `main.py` (–ª–æ–∫–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç)
```python
await chat_stream_ollama(role_manager, memory, user_text, model_name=ollama_config.get('model', 'gemma3n:e2b'), speak=True, user_name="–ë—É—É")
```

#### `auto_activity.py`
```python
response = await chat_stream_ollama(role_manager, memory, prompt, speak=True, user_name="–°–∫–∞–π")
```

#### `discord_voice_bot.py`
```python
response = await chat_stream_ollama(role_manager, None, text, speak=False, user_name="Discord User")
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –° –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π
```
–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç: "–¢—ã –°–∫–∞–π, –≤–µ–¥—É—â–∞—è —Å—Ç—Ä–∏–º —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í–∏–∫—Ç–æ—Ä."
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"
–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: "–ü—Ä–∏–≤–µ—Ç, –í–∏–∫—Ç–æ—Ä! üòä –ö–∞–∫ –¥–µ–ª–∞ —É —Ç–µ–±—è? –ù–∞–¥–µ—é—Å—å, –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ!"
```

### –ë–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
```
–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç: "–¢—ã –°–∫–∞–π, –≤–µ–¥—É—â–∞—è —Å—Ç—Ä–∏–º —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏."
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"
–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: "–ü—Ä–∏–≤–µ—Ç! üòä –ö–∞–∫ –¥–µ–ª–∞? –ù–∞–¥–µ—é—Å—å, –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ!"
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ –∏–º–µ–Ω–∏
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
4. **–ì–∏–±–∫–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `test_user_personalization.py`:

```bash
cd assistant
python test_user_personalization.py
```

–≠—Ç–æ—Ç —Ç–µ—Å—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –±–µ–∑ –Ω–µ—ë –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- **Twitch**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —á–∞—Ç–∞
- **YouTube**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º—è –∞–≤—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- **Telegram**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç first_name –∏–ª–∏ username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–õ–æ–∫–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º—è "–ë—É—É" (—Å–æ–∑–¥–∞—Ç–µ–ª—å)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º—è "–°–∫–∞–π" (—Å–∞–º–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç)
- **Discord**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–µ–µ –∏–º—è "Discord User"

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –ï—Å–ª–∏ `user_name` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –í—Å–µ –º–æ–¥—É–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ 