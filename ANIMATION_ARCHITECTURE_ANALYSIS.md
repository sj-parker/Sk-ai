# –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∞–Ω–∏–º–∞—Ü–∏–π VRM –ø—Ä–æ–µ–∫—Ç–∞

## üìã –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### A. –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∏–º–∞—Ü–∏–π
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    VRMStreamingApp                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1. –ö–æ—Å—Ç–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (movementMixer)                        ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ idle, talking, thinking, greeting, etc.             ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –¢–æ–ª—å–∫–æ –û–î–ù–ê –∞–∫—Ç–∏–≤–Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 2. Blend Shapes (morphTargetInfluences)                    ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –≠–º–æ—Ü–∏–∏ (—É–ª—ã–±–∫–∞, —É–¥–∏–≤–ª–µ–Ω–∏–µ, –≥—Ä—É—Å—Ç—å)                  ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ú–æ—Ä–≥–∞–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ + —Ä—É—á–Ω–æ–µ)                  ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –õ–∏–ø—Å–∏–Ω–∫ (Fcl_MTH_A, Fcl_MTH_I, etc.)               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 3. –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Å—Ç—è–º–∏ (–ø—Ä–∏ pauseAnimation)          ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ UI —Å–ª–∞–π–¥–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ—Å—Ç–µ–π                         ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∑                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### B. WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```
Python Assistant ‚Üê‚Üí WebSocket ‚Üê‚Üí VRM Client
     ‚îÇ                ‚îÇ              ‚îÇ
     ‚îú‚îÄ status        ‚îú‚îÄ emotion     ‚îú‚îÄ camera_control
     ‚îú‚îÄ emotion       ‚îú‚îÄ animation   ‚îú‚îÄ pose_control  
     ‚îú‚îÄ lipsync       ‚îú‚îÄ speech      ‚îî‚îÄ light_control
     ‚îî‚îÄ animation     ‚îî‚îÄ lipsync
```

### 2. –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### A. –ö–æ—Å—Ç–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (movementAnimations)
```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π —á–µ—Ä–µ–∑ THREE.AnimationClip
createIdleAnimation() {
    const idleAnimation = new THREE.AnimationClip('idle', 4, []);
    // VectorKeyframeTrack –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ—Å—Ç–∏
    const leftArmTrack = new THREE.VectorKeyframeTrack(
        `${leftArm.name}.rotation[x]`,
        [0, 1, 2, 3, 4],
        [0, 0.03, 0, -0.03, 0]
    );
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∞–Ω–∏–º–∞—Ü–∏—è–º–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚ùå –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π
- ‚ùå –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ –∫–∞–¥—Ä—ã

#### B. Blend Shapes —Å–∏—Å—Ç–µ–º–∞
```javascript
// –≠–º–æ—Ü–∏–∏
applyEmotion(emotionName) {
    const emotionValues = {
        'happy': { 'Fcl_HAP_HAP': 0.8, 'Fcl_SAD_SAD': 0 },
        'sad': { 'Fcl_HAP_HAP': 0, 'Fcl_SAD_SAD': 0.7 }
    };
}

// –õ–∏–ø—Å–∏–Ω–∫ —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π
updateLipsync(delta) {
    Object.keys(this.lipsyncBlendShapes).forEach(key => {
        this.lipsyncLerp.current[key] += 
            (this.lipsyncLerp.target[key] - this.lipsyncLerp.current[key]) * speed;
    });
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–ª–∞–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–π
- ‚úÖ –•–æ—Ä–æ—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª–∏–ø—Å–∏–Ω–∫–æ–º

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É —ç–º–æ—Ü–∏—è–º–∏
- ‚ùå –ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ blend shapes

#### C. –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Å—Ç—è–º–∏
```javascript
// –°–∏—Å—Ç–µ–º–∞ –ø–∞—É–∑—ã –∞–Ω–∏–º–∞—Ü–∏–∏
pauseCheckbox.addEventListener('change', (e) => {
    this.pauseAnimation = pauseCheckbox.checked;
    if (this.pauseAnimation) {
        if (this.movementMixer) this.movementMixer.stopAllAction();
    } else {
        this.updateBaseBoneRotationsFromCurrentPose();
        if (this.currentMovement) this.currentMovement.play();
    }
});
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ–∑–æ–π
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∑
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OBS

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –û—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- ‚ùå –ù–µ—Ç –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏

## üöÄ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–π

```javascript
class AnimationPrioritySystem {
    constructor() {
        this.layers = {
            BASE: 0,        // idle, breathing
            MOVEMENT: 1,    // talking, thinking
            GESTURE: 2,     // greeting, surprise
            EMERGENCY: 3    // interrupt animations
        };
        this.activeAnimations = new Map();
    }
    
    playAnimation(name, priority, blendTime = 0.3) {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ —Å –º–µ–Ω—å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
        this.stopLowerPriority(priority);
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é —Å –ø–ª–∞–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º
        const action = this.mixer.clipAction(this.animations[name]);
        action.setEffectiveWeight(1);
        action.fadeIn(blendTime);
        action.play();
        
        this.activeAnimations.set(priority, action);
    }
}
```

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Blend Shapes

```javascript
class BlendShapeManager {
    constructor() {
        this.categories = {
            EMOTIONS: ['happy', 'sad', 'angry', 'surprised'],
            LIPSYNC: ['Fcl_MTH_A', 'Fcl_MTH_I', 'Fcl_MTH_U'],
            BLINKING: ['Fcl_EYE_CLOSE_L', 'Fcl_EYE_CLOSE_R'],
            CUSTOM: [] // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ
        };
        this.activeShapes = new Map();
        this.priorities = new Map();
    }
    
    applyBlendShape(name, value, priority = 0, duration = 0.3) {
        const current = this.activeShapes.get(name) || 0;
        const target = Math.max(0, Math.min(1, value));
        
        // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–µ—Ä–µ—Ö–æ–¥–∞
        const tween = new TWEEN.Tween({ value: current })
            .to({ value: target }, duration * 1000)
            .easing(TWEEN.Easing.Quadratic.Out)
            .onUpdate((obj) => {
                this.setBlendShapeValue(name, obj.value);
            });
        
        tween.start();
        this.activeShapes.set(name, target);
        this.priorities.set(name, priority);
    }
}
```

### 3. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞–Ω–∏–º–∞—Ü–∏–∏

```javascript
class AnimationStateMachine {
    constructor() {
        this.states = {
            IDLE: 'idle',
            TALKING: 'talking',
            THINKING: 'thinking',
            GESTURING: 'gesturing',
            EMOTIONAL: 'emotional'
        };
        this.currentState = this.states.IDLE;
        this.transitions = new Map();
        this.setupTransitions();
    }
    
    setupTransitions() {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
        this.transitions.set(this.states.IDLE, [
            this.states.TALKING, 
            this.states.THINKING, 
            this.states.GESTURING
        ]);
        this.transitions.set(this.states.TALKING, [
            this.states.IDLE, 
            this.states.EMOTIONAL
        ]);
        // ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
    }
    
    transitionTo(newState, blendTime = 0.5) {
        if (this.canTransitionTo(newState)) {
            const oldState = this.currentState;
            this.currentState = newState;
            
            // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
            this.blendAnimations(oldState, newState, blendTime);
            
            console.log(`–ü–µ—Ä–µ—Ö–æ–¥: ${oldState} ‚Üí ${newState}`);
        }
    }
}
```

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏–ø—Å–∏–Ω–∫–∞

```javascript
class AdvancedLipsyncSystem {
    constructor() {
        this.phonemeMap = {
            'A': { shapes: ['Fcl_MTH_A'], weight: 1.0 },
            'I': { shapes: ['Fcl_MTH_I'], weight: 1.0 },
            'U': { shapes: ['Fcl_MTH_U'], weight: 1.0 },
            'E': { shapes: ['Fcl_MTH_E'], weight: 1.0 },
            'O': { shapes: ['Fcl_MTH_O'], weight: 1.0 },
            'M': { shapes: ['Fcl_MTH_A', 'Fcl_MTH_I'], weight: 0.3 },
            'B': { shapes: ['Fcl_MTH_A'], weight: 0.7 },
            'P': { shapes: ['Fcl_MTH_A'], weight: 0.5 }
        };
        this.energyFilter = new EnergyFilter();
        this.jitterGenerator = new JitterGenerator();
    }
    
    processLipsync(phoneme, energy, timing) {
        const config = this.phonemeMap[phoneme];
        if (!config) return;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä —ç–Ω–µ—Ä–≥–∏–∏
        const filteredEnergy = this.energyFilter.process(energy);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–∏–∫—Ä–æ–¥—Ä–æ–∂–∞–Ω–∏–µ
        const jitter = this.jitterGenerator.generate(filteredEnergy);
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ blend shapes
        config.shapes.forEach(shapeName => {
            const value = filteredEnergy * config.weight + jitter;
            this.applyBlendShape(shapeName, value, 10); // –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
        });
    }
}
```

### 5. –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –∞–Ω–∏–º–∞—Ü–∏–∏

```javascript
class AnimationEventSystem {
    constructor() {
        this.events = new Map();
        this.callbacks = new Map();
    }
    
    addEvent(animationName, time, eventName, data = {}) {
        if (!this.events.has(animationName)) {
            this.events.set(animationName, []);
        }
        
        this.events.get(animationName).push({
            time,
            eventName,
            data
        });
    }
    
    onAnimationEvent(eventName, callback) {
        if (!this.callbacks.has(eventName)) {
            this.callbacks.set(eventName, []);
        }
        this.callbacks.get(eventName).push(callback);
    }
    
    triggerEvent(eventName, data) {
        const callbacks = this.callbacks.get(eventName) || [];
        callbacks.forEach(callback => callback(data));
    }
}
```

## üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ

**–≠—Ç–∞–ø 1: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (1-2 –Ω–µ–¥–µ–ª–∏)**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞–Ω–∏–º–∞—Ü–∏—è–º
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–≠—Ç–∞–ø 2: –£–ª—É—á—à–µ–Ω–Ω—ã–µ Blend Shapes (1 –Ω–µ–¥–µ–ª—è)**
- –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ blend shapes
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —ç–º–æ—Ü–∏–π
- –£–ª—É—á—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç-—Ä–µ–∑–æ–ª—é—Ü–∏—é

**–≠—Ç–∞–ø 3: State Machine (2 –Ω–µ–¥–µ–ª–∏)**
- –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å WebSocket

**–≠—Ç–∞–ø 4: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ª–∏–ø—Å–∏–Ω–∫ (1 –Ω–µ–¥–µ–ª—è)**
- –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É —Ñ–æ–Ω–µ–º
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã —ç–Ω–µ—Ä–≥–∏–∏
- –£–ª—É—á—à–∏—Ç—å –º–∏–∫—Ä–æ–¥—Ä–æ–∂–∞–Ω–∏–µ

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```javascript
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π
class AnimationCache {
    constructor() {
        this.cache = new Map();
        this.maxCacheSize = 50;
    }
    
    getAnimation(name) {
        if (this.cache.has(name)) {
            return this.cache.get(name);
        }
        
        const animation = this.createAnimation(name);
        this.cache.set(name, animation);
        
        // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
        if (this.cache.size > this.maxCacheSize) {
            const firstKey = this.cache.keys().next().value;
            this.cache.delete(firstKey);
        }
        
        return animation;
    }
}

// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
class RenderOptimizer {
    constructor() {
        this.frameSkip = 0;
        this.maxFrameSkip = 2;
    }
    
    shouldRender() {
        this.frameSkip++;
        if (this.frameSkip > this.maxFrameSkip) {
            this.frameSkip = 0;
            return true;
        }
        return false;
    }
}
```

### 3. –£–ª—É—á—à–µ–Ω–∏–µ WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```javascript
class EnhancedWebSocketClient {
    constructor() {
        this.messageQueue = [];
        this.reconnectStrategy = new ExponentialBackoff();
        this.heartbeat = new HeartbeatManager();
    }
    
    sendMessage(message) {
        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
        const enhancedMessage = {
            ...message,
            timestamp: Date.now(),
            sequence: this.getNextSequence(),
            client: 'vrm_overlay'
        };
        
        this.messageQueue.push(enhancedMessage);
        this.processQueue();
    }
    
    handleMessage(data) {
        const message = JSON.parse(data);
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
        if (!this.validateMessage(message)) {
            console.warn('Invalid message received:', message);
            return;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        const delay = this.calculateDelay(message);
        setTimeout(() => {
            this.processMessage(message);
        }, delay);
    }
}
```

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–Ω–∏–º–∞—Ü–∏–π —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞. –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞:

1. **–ì–∏–±–∫–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π

–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ, —Å–æ—Ö—Ä–∞–Ω—è—è –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º. 